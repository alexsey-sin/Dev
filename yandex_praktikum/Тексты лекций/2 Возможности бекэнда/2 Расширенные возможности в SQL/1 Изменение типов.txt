Изменение типов

Некоторые агрегирующие функции работают только с числовыми типами данных.
Потому такой запрос не выполнится для books:

	SELECT 
		AVG(pages) AS average
	FROM
		books; 

Взгляните на таблицу:
books

id	Name	genre	author	date_pub	pages	price	rating	pub_name
1	Капитанская дочка	5	Александр Пушкин	1836-01-01	130	150	4.7	АСТ
2	Отцы и дети	1	Иван Тургенев	1862-01-01	240	207	4.7	Белый город
3	Вишнёвый сад	7	Антон Чехов	1903-01-01	60	138	4.4	Росмэн
4	Война и мир	1	Лев Толстой	1869-01-01	1274			Знание
5	Анна Каренина	1	Лев Толстой	1877-01-01	1000	126	4.6	Эксмо
6	Цветы для Элджернона	4	Дэниел Киз	1959-01-01	250	280	4.7	ЛитРес
7	Похороните меня за плинтусом...	5	Павел Санаев	1994-01-01	184	198	4.1	АСТ
8	Зелёная миля	9	Стивен Кинг	1996-01-01	420	190	4.8	Белый город
9	Унесённые ветром	1	Маргарет Митчел	1936-01-01	624	358		Росмэн
10	Три товарища	1	Эрих Мария Ремарк	1936-01-01	470	196	4.7	АСТ
11	На Западном фронте без перемен	4	Эрих Мария Ремарк	1929-01-01	200	273	4.6	Белый город
12	Триумфальная арка	1	Эрих Мария Ремарк	1945-01-01	520	220	4.7	Росмэн
13	Чёрный обелиск	1	Эрих Мария Ремарк	1956-01-01	480	420	4.6	ЛитРес
14	Ночь в Лиссабоне	1	Эрих Мария Ремарк	1961-01-01	250	187	4.7	ЛитРес
15	Жизнь взаймы	1	Эрих Мария Ремарк	1959-01-01	240	240	4.6	ЛитРес
16	Станция на горизонте	1	Эрих Мария Ремарк	1927-01-01	210		4.1	Росмэн
17	Евгений Онегин	1	Александр Пушкин	1832-01-01	736	330	4.7	Росмэн

Данные в выборке выглядят как числа, но в базе данных хранятся как строки.
В жизни такое встречается часто — обычно из-за ошибок проектирования базы данных.

Изменим тип данных столбца в самом SQL-запросе. Типы преобразуют конструкцией CAST
(от англ. «преобразование»): 

	CAST (название_столбца AS тип_данных)

Название_столбца — это поле, тип данных которого нужно преобразовать. Тип_данных
— тип, в который данные нужно перевести. Есть и другая форма записи:

	название_столбца :: тип_данных 

Осталось познакомиться с типами данных в SQL. 

Числовые типы данных

integer — целочисленный тип, аналогичный типу int в Python. В SQL диапазон целых
чисел от -2147483648 до 2147483647.

real — число с плавающей точкой, как float в Python. Точность числа типа real до
6 десятичных разрядов.

Строковые типы данных

'Практикум' — значение строкового типа, в SQL запросе его заключают в одинарные
кавычки.

varchar(n) — строка переменной длины, где n — ограничение. Этот тип данных похож
на string в Python, но в отличие от него ограничен по длине: в поле можно занести
любую строку короче, чем n символов.

text — строка любой длины. Полный аналог string в Python.

Дата и время

Любые вводимые значения даты или времени заключают в одинарные кавычки.

timestamp — дата и время. В формате timestamp чаще всего хранят события,
происходящие несколько раз за день. Например, логи пользователей сайта.

date — дата.

Логический

boolean — логический тип данных. В SQL есть три варианта значений TRUE — «истина»,
FALSE — «ложь» и NULL — «неизвестно».

Вы изучили распространённые типы данных. Есть и много других. Вы можете
познакомиться с ними самостоятельно в документации.

Вернёмся к «нерешаемой» задаче. Найдём среднее число страниц двумя способами:

	SELECT 
		AVG(pages :: integer) AS average
	FROM
		books; 

или:

	SELECT 
		AVG (CAST(pages AS integer)) AS average
	FROM
		books; 

	428,7058824 

В данных о молочной продукции тоже есть ошибка. Данные поля weight записаны как
строки, хотя на самом деле это числа. По такому поводу стоит написать баг-репорт.
А пока исправьте эту ошибку локально, в запросе.

===============================================================================
Тренажер

Задача 1/2:

Напишите запрос, который найдёт средний вес (weight) товаров из таблицы
products_data_all в граммах (где units='г'). Назовите переменную average.
Измените тип данных в столбце weight на число с плавающей точкой.

Подсказка:

Измените тип значений в столбце weight конструкцией weight::real. Найдите среднее
значение по столбцу агрегирующей функцией AVG(). Сделайте срез по данным, единицы
измерения которых — граммы, так: WHERE units='г'.

	SELECT 
		AVG(CAST(weight AS real)) AS average
	FROM
		products_data_all
	WHERE
		units = 'г'

Задача 1/2:

Напишите запрос, который найдёт максимальный вес продукта в категории
'молоко и сливки'. Воспользуйтесь конструкцией CAST AS для приведения значений
к числу с плавающей точкой и назовите переменную max_weight.

Подсказка:

Преобразуйте значение weight к числу с плавающей точкой, а затем примените
функцию MAX().

	SELECT 
		MAX(CAST(weight AS real)) AS max_weight
	FROM
		products_data_all
	WHERE
		units = 'г' AND CATEGORY = 'молоко и сливки'
===============================================================================
